---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { beats } from "../../../data/beats";

// Récupérer l'ID du beat depuis l'URL
const { id } = Astro.params;

// Trouver le beat correspondant
const beat = beats.find(b => b.id === id);

// Si le beat n'existe pas, on renvoie une 404
if (!beat) {
  return Astro.redirect('/404');
}

// Simuler des beats similaires (dans un vrai site, cela viendrait d'une requête API)
const similarBeats = beats.filter(b => b.id !== id).slice(0, 4);
---

<BaseLayout title={`${beat.title} | MokingJayy`} showPlayer={true}>
  <div class="bg-gray-900 min-h-screen pt-20 pb-32">
    <div class="container mx-auto px-4">
      <!-- En-tête -->
      <div class="flex flex-col md:flex-row gap-8 mb-12">
        <!-- Image de couverture -->
        <div class="md:w-1/3 lg:w-1/4">
          <div class="aspect-square bg-gray-800 rounded-lg overflow-hidden shadow-xl">
            <img 
              src={beat.coverImage} 
              alt={`${beat.title} cover`}
              class="w-full h-full object-cover"
            />
          </div>
          
          <!-- Boutons d'action -->
          <div class="mt-6 space-y-3">
            <button class="w-full bg-secondary text-white py-3 rounded-lg font-medium hover:bg-opacity-90 transition-colors">
              Ajouter au panier - ${beat.price.mp3.toFixed(2)} €
            </button>
            <button class="w-full bg-gray-800 text-white py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors">
              <div class="flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
                Ajouter aux favoris
              </div>
            </button>
          </div>
          
          <!-- Détails techniques -->
          <div class="mt-6 bg-gray-800 rounded-lg p-4">
            <h3 class="font-medium text-lg mb-3">Détails techniques</h3>
            <ul class="space-y-2 text-sm text-gray-300">
              <li class="flex justify-between">
                <span class="text-gray-400">BPM:</span>
                <span class="font-medium">{beat.bpm}</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-400">Tonalité:</span>
                <span class="font-medium">{beat.key}</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-400">Genre:</span>
                <div class="flex flex-wrap gap-1">
                  {beat.genre.map(g => (
                    <span class="bg-gray-700 text-xs px-2 py-1 rounded">{g}</span>
                  ))}
                </div>
              </li>
            </ul>
          </div>
        </div>
        
        <!-- Contenu principal -->
        <div class="md:w-2/3 lg:w-3/4">
          <div class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold mb-2">{beat.title}</h1>
            <p class="text-gray-400 text-lg">Par MokingJayy</p>
          </div>
          
          <!-- Lecteur audio -->
          <div class="bg-gray-800 rounded-xl p-6 mb-8">
            <div class="flex items-center mb-4">
              <button class="play-button bg-secondary text-white p-3 rounded-full hover:bg-opacity-90 transition-colors"
                      data-audio-src={beat.previewUrl}>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </button>
              <div class="ml-4 flex-1">
                <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
                  <div class="h-full bg-secondary w-1/3"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-400 mt-1">
                  <span>0:00</span>
                  <span>3:45</span>
                </div>
              </div>
            </div>
            
            <div class="flex items-center justify-between mt-4">
              <div class="flex items-center space-x-4">
                <button class="text-gray-400 hover:text-white">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                  </svg>
                </button>
                <button class="text-gray-400 hover:text-white">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" />
                  </svg>
                </button>
              </div>
              <div class="text-sm text-gray-400">
                <span class="text-white font-medium">124</span> écoutes
              </div>
            </div>
          </div>
          
          <!-- Options d'achat -->
          <div class="mb-12">
            <h2 class="text-2xl font-bold mb-6">Options d'achat</h2>
            
            <div class="grid md:grid-cols-3 gap-4">
              <!-- MP3 -->
              <div class="border border-gray-700 rounded-lg p-6 hover:border-secondary transition-colors">
                <div class="flex justify-between items-start mb-4">
                  <div>
                    <h3 class="font-bold text-lg">MP3</h3>
                    <p class="text-gray-400 text-sm">Téléchargement instantané</p>
                  </div>
                  <span class="text-2xl font-bold">${beat.price.mp3.toFixed(2)} €</span>
                </div>
                <ul class="text-sm text-gray-300 space-y-2 mb-6">
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Qualité 320 kbps
                  </li>
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Tag MokingJayy dans le fichier
                  </li>
                </ul>
                <button class="w-full bg-secondary text-white py-2 rounded-lg font-medium hover:bg-opacity-90 transition-colors">
                  Acheter MP3
                </button>
              </div>
              
              <!-- WAV -->
              <div class="border-2 border-secondary rounded-lg p-6 bg-gray-800/30">
                <div class="absolute -top-2 right-4 bg-secondary text-white text-xs font-bold px-2 py-1 rounded">
                  POPULAIRE
                </div>
                <div class="flex justify-between items-start mb-4">
                  <div>
                    <h3 class="font-bold text-lg">WAV</h3>
                    <p class="text-gray-400 text-sm">Haute qualité</p>
                  </div>
                  <span class="text-2xl font-bold">${beat.price.wav.toFixed(2)} €</span>
                </div>
                <ul class="text-sm text-gray-300 space-y-2 mb-6">
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Qualité CD (16-bit, 44.1 kHz)
                  </li>
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Sans tag
                  </li>
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Fichiers séparés (stems)
                  </li>
                </ul>
                <button class="w-full bg-secondary text-white py-2 rounded-lg font-medium hover:bg-opacity-90 transition-colors">
                  Acheter WAV + Stems
                </button>
              </div>
              
              <!-- Licence exclusive -->
              <div class="border border-gray-700 rounded-lg p-6 hover:border-secondary transition-colors">
                <div class="flex justify-between items-start mb-4">
                  <div>
                    <h3 class="font-bold text-lg">Licence exclusive</h3>
                    <p class="text-gray-400 text-sm">Pour les pros</p>
                  </div>
                  <span class="text-2xl font-bold">${(beat.price.stems * 5).toFixed(2)} €</span>
                </div>
                <ul class="text-sm text-gray-300 space-y-2 mb-6">
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Tous les fichiers inclus
                  </li>
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Droits exclusifs
                  </li>
                  <li class="flex items-start">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    Support prioritaire
                  </li>
                </ul>
                <button class="w-full bg-gray-700 text-white py-2 rounded-lg font-medium hover:bg-gray-600 transition-colors">
                  Contacter pour plus d'infos
                </button>
              </div>
            </div>
          </div>
          
          <!-- Description -->
          <div class="mb-12">
            <h2 class="text-2xl font-bold mb-4">Description</h2>
            <div class="prose prose-invert max-w-none">
              <p>
                {beat.title} est un beat {beat.genre.join('/').toLowerCase()} produit par MokingJayy. 
                Avec un tempo de {beat.bpm} BPM et une tonalité en {beat.key}, ce beat est parfait pour les artistes 
                cherchant un son moderne et percutant pour leurs projets musicaux.
              </p>
              <p class="mt-4">
                Ce beat est disponible en plusieurs formats pour répondre à tous vos besoins créatifs. 
                Que vous soyez un artiste émergent ou confirmé, vous trouverez l'option qui vous convient.
              </p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Beats similaires -->
      {similarBeats.length > 0 && (
        <div class="mt-16">
          <h2 class="text-2xl font-bold mb-6">Vous aimerez aussi</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            {similarBeats.map(similarBeat => (
              <a href={`/beats/${similarBeat.id}`} class="block group">
                <div class="relative overflow-hidden rounded-lg">
                  <img 
                    src={similarBeat.coverImage} 
                    alt={similarBeat.title}
                    class="w-full h-48 object-cover transform group-hover:scale-105 transition-transform duration-300"
                  />
                  <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                    <div class="bg-secondary text-white p-3 rounded-full">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                      </svg>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <h3 class="font-medium group-hover:text-secondary transition-colors">{similarBeat.title}</h3>
                  <p class="text-sm text-gray-400">{similarBeat.bpm} BPM • {similarBeat.key}</p>
                  <div class="mt-1 flex justify-between items-center">
                    <span class="text-sm font-medium">${similarBeat.price.mp3.toFixed(2)}</span>
                    <span class="text-xs bg-gray-800 text-gray-300 px-2 py-1 rounded">MP3</span>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </div>
      )}
    </div>
  </div>
</BaseLayout>

<style>
  /* Styles spécifiques à la page de détail d'un beat */
  .prose {
    color: #e5e7eb;
  }
  
  .prose a {
    color: #f472b6;
    text-decoration: none;
  }
  
  .prose a:hover {
    text-decoration: underline;
  }
  
  .prose p {
    margin-bottom: 1rem;
    line-height: 1.6;
  }
  
  .prose h2, 
  .prose h3, 
  .prose h4 {
    color: white;
    margin-top: 1.5em;
    margin-bottom: 0.75em;
    line-height: 1.3;
  }
  
  .prose ul {
    list-style-type: none;
    padding-left: 0;
  }
  
  .prose li {
    position: relative;
    padding-left: 1.5em;
    margin-bottom: 0.5em;
  }
  
  .prose li:before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.6em;
    width: 0.5em;
    height: 0.5em;
    background-color: #f472b6;
    border-radius: 50%;
  }
</style>
